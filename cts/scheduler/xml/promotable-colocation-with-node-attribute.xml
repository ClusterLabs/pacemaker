<cib crm_feature_set="3.19.7" validate-with="pacemaker-3.10" epoch="1" num_updates="0" admin_epoch="0" cib-last-written="Mon Jan 1 12:00:00 2024" have-quorum="1" dc-uuid="node1">
  <configuration>
    <crm_config>
      <cluster_property_set id="cib-bootstrap-options">
        <nvpair id="cib-bootstrap-options-dc-version" name="dc-version" value="2.1.8"/>
        <nvpair id="cib-bootstrap-options-cluster-infrastructure" name="cluster-infrastructure" value="corosync"/>
        <nvpair id="cib-bootstrap-options-stonith-enabled" name="stonith-enabled" value="false"/>
      </cluster_property_set>
    </crm_config>
    <nodes>
      <!-- Site A nodes -->
      <node id="node1" uname="node1">
        <instance_attributes id="node1-attrs">
          <nvpair id="node1-site" name="site" value="siteA"/>
        </instance_attributes>
      </node>
      <node id="node2" uname="node2">
        <instance_attributes id="node2-attrs">
          <nvpair id="node2-site" name="site" value="siteA"/>
        </instance_attributes>
      </node>
      <!-- Site B nodes -->
      <node id="node3" uname="node3">
        <instance_attributes id="node3-attrs">
          <nvpair id="node3-site" name="site" value="siteB"/>
        </instance_attributes>
      </node>
      <node id="node4" uname="node4">
        <instance_attributes id="node4-attrs">
          <nvpair id="node4-site" name="site" value="siteB"/>
        </instance_attributes>
      </node>
    </nodes>
    <resources>
      <!-- Primary promotable clone -->
      <clone id="primary-clone">
        <meta_attributes id="primary-clone-meta">
          <nvpair id="primary-clone-promotable" name="promotable" value="true"/>
          <nvpair id="primary-clone-promoted-max" name="promoted-max" value="1"/>
          <nvpair id="primary-clone-clone-max" name="clone-max" value="4"/>
        </meta_attributes>
        <primitive id="primary-rsc" class="ocf" provider="pacemaker" type="Stateful">
          <operations>
            <op id="primary-rsc-monitor-promoted" name="monitor" interval="10s" role="Promoted"/>
            <op id="primary-rsc-monitor-unpromoted" name="monitor" interval="11s" role="Unpromoted"/>
          </operations>
        </primitive>
      </clone>
      <!-- Dependent promotable clone -->
      <clone id="dependent-clone">
        <meta_attributes id="dependent-clone-meta">
          <nvpair id="dependent-clone-promotable" name="promotable" value="true"/>
          <nvpair id="dependent-clone-promoted-max" name="promoted-max" value="2"/>
          <nvpair id="dependent-clone-clone-max" name="clone-max" value="4"/>
        </meta_attributes>
        <primitive id="dependent-rsc" class="ocf" provider="pacemaker" type="Stateful">
          <operations>
            <op id="dependent-rsc-monitor-promoted" name="monitor" interval="10s" role="Promoted"/>
            <op id="dependent-rsc-monitor-unpromoted" name="monitor" interval="11s" role="Unpromoted"/>
          </operations>
        </primitive>
      </clone>
    </resources>
    <constraints>
      <!--
        This constraint should ensure that dependent-clone is promoted
        on all nodes in the same site as where primary-clone is promoted.
        With the fix, if primary-clone is promoted on nodes in siteA,
        dependent-clone should also be promoted on nodes in siteA.
      -->
      <rsc_colocation id="coloc-dependent-with-primary-promoted"
                      rsc="dependent-clone"
                      rsc-role="Promoted"
                      with-rsc="primary-clone"
                      with-rsc-role="Promoted"
                      node-attribute="site"
                      score="INFINITY"/>
    </constraints>
  </configuration>
  <status>
    <!-- All nodes are online and clean -->
    <node_state id="node1" uname="node1" in_ccm="true" crmd="online" join="member" expected="member">
      <transient_attributes id="node1-transient">
        <instance_attributes id="node1-transient-attrs">
          <nvpair id="node1-promoted-primary-rsc" name="master-primary-rsc" value="10"/>
          <nvpair id="node1-promoted-dependent-rsc" name="master-dependent-rsc" value="5"/>
        </instance_attributes>
      </transient_attributes>
      <lrm id="node1-lrm">
        <lrm_resources>
          <lrm_resource id="primary-rsc" type="Stateful" class="ocf" provider="pacemaker">
            <lrm_rsc_op id="primary-rsc_last_0" operation_key="primary-rsc_promote_0" operation="promote" crm-debug-origin="do_update_resource" transition-key="1:0:0:test" on_node="node1" call-id="10" rc-code="0" op-status="0" interval="0" last-rc-change="1609459200" exec-time="100" queue-time="0" op-digest="f2317cad3d54cec5d7d7aa7d0bf35cf8"/>
          </lrm_resource>
          <lrm_resource id="dependent-rsc" type="Stateful" class="ocf" provider="pacemaker">
            <lrm_rsc_op id="dependent-rsc_last_0" operation_key="dependent-rsc_start_0" operation="start" crm-debug-origin="do_update_resource" transition-key="1:0:0:test" on_node="node1" call-id="10" rc-code="0" op-status="0" interval="0" last-rc-change="1609459200" exec-time="100" queue-time="0" op-digest="f2317cad3d54cec5d7d7aa7d0bf35cf8"/>
          </lrm_resource>
        </lrm_resources>
      </lrm>
    </node_state>
    <node_state id="node2" uname="node2" in_ccm="true" crmd="online" join="member" expected="member">
      <transient_attributes id="node2-transient">
        <instance_attributes id="node2-transient-attrs">
          <nvpair id="node2-promoted-primary-rsc" name="master-primary-rsc" value="5"/>
          <nvpair id="node2-promoted-dependent-rsc" name="master-dependent-rsc" value="5"/>
        </instance_attributes>
      </transient_attributes>
      <lrm id="node2-lrm">
        <lrm_resources>
          <lrm_resource id="primary-rsc" type="Stateful" class="ocf" provider="pacemaker">
            <lrm_rsc_op id="primary-rsc_last_0" operation_key="primary-rsc_start_0" operation="start" crm-debug-origin="do_update_resource" transition-key="1:0:0:test" on_node="node2" call-id="10" rc-code="0" op-status="0" interval="0" last-rc-change="1609459200" exec-time="100" queue-time="0" op-digest="f2317cad3d54cec5d7d7aa7d0bf35cf8"/>
          </lrm_resource>
          <lrm_resource id="dependent-rsc" type="Stateful" class="ocf" provider="pacemaker">
            <lrm_rsc_op id="dependent-rsc_last_0" operation_key="dependent-rsc_start_0" operation="start" crm-debug-origin="do_update_resource" transition-key="1:0:0:test" on_node="node2" call-id="10" rc-code="0" op-status="0" interval="0" last-rc-change="1609459200" exec-time="100" queue-time="0" op-digest="f2317cad3d54cec5d7d7aa7d0bf35cf8"/>
          </lrm_resource>
        </lrm_resources>
      </lrm>
    </node_state>
    <node_state id="node3" uname="node3" in_ccm="true" crmd="online" join="member" expected="member">
      <transient_attributes id="node3-transient">
        <instance_attributes id="node3-transient-attrs">
          <nvpair id="node3-promoted-primary-rsc" name="master-primary-rsc" value="5"/>
          <nvpair id="node3-promoted-dependent-rsc" name="master-dependent-rsc" value="10"/>
        </instance_attributes>
      </transient_attributes>
      <lrm id="node3-lrm">
        <lrm_resources>
          <lrm_resource id="primary-rsc" type="Stateful" class="ocf" provider="pacemaker">
            <lrm_rsc_op id="primary-rsc_last_0" operation_key="primary-rsc_start_0" operation="start" crm-debug-origin="do_update_resource" transition-key="1:0:0:test" on_node="node3" call-id="10" rc-code="0" op-status="0" interval="0" last-rc-change="1609459200" exec-time="100" queue-time="0" op-digest="f2317cad3d54cec5d7d7aa7d0bf35cf8"/>
          </lrm_resource>
          <lrm_resource id="dependent-rsc" type="Stateful" class="ocf" provider="pacemaker">
            <lrm_rsc_op id="dependent-rsc_last_0" operation_key="dependent-rsc_promote_0" operation="promote" crm-debug-origin="do_update_resource" transition-key="1:0:0:test" on_node="node3" call-id="10" rc-code="0" op-status="0" interval="0" last-rc-change="1609459200" exec-time="100" queue-time="0" op-digest="f2317cad3d54cec5d7d7aa7d0bf35cf8"/>
          </lrm_resource>
        </lrm_resources>
      </lrm>
    </node_state>
    <node_state id="node4" uname="node4" in_ccm="true" crmd="online" join="member" expected="member">
      <transient_attributes id="node4-transient">
        <instance_attributes id="node4-transient-attrs">
          <nvpair id="node4-promoted-primary-rsc" name="master-primary-rsc" value="5"/>
          <nvpair id="node4-promoted-dependent-rsc" name="master-dependent-rsc" value="5"/>
        </instance_attributes>
      </transient_attributes>
      <lrm id="node4-lrm">
        <lrm_resources>
          <lrm_resource id="primary-rsc" type="Stateful" class="ocf" provider="pacemaker">
            <lrm_rsc_op id="primary-rsc_last_0" operation_key="primary-rsc_start_0" operation="start" crm-debug-origin="do_update_resource" transition-key="1:0:0:test" on_node="node4" call-id="10" rc-code="0" op-status="0" interval="0" last-rc-change="1609459200" exec-time="100" queue-time="0" op-digest="f2317cad3d54cec5d7d7aa7d0bf35cf8"/>
          </lrm_resource>
          <lrm_resource id="dependent-rsc" type="Stateful" class="ocf" provider="pacemaker">
            <lrm_rsc_op id="dependent-rsc_last_0" operation_key="dependent-rsc_start_0" operation="start" crm-debug-origin="do_update_resource" transition-key="1:0:0:test" on_node="node4" call-id="10" rc-code="0" op-status="0" interval="0" last-rc-change="1609459200" exec-time="100" queue-time="0" op-digest="f2317cad3d54cec5d7d7aa7d0bf35cf8"/>
          </lrm_resource>
        </lrm_resources>
      </lrm>
    </node_state>
  </status>
</cib>
