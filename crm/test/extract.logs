#!/bin/bash
#
# Copyright (C) 2004 Andrew Beekhof <andrew@beekhof.net>
# License:   GNU General Public License (GPL)
#

dirname=$1; shift;
prefix=$1; shift;
filename=$1; shift;

systems="crmd cib tengine pengine cib cibmon"
tags=""
strip_tags="live.dot cib.updates"

for subsys in $systems; do
    echo Extracting ${subsys} logs...
    grep "${subsys}:" "${filename}" > "${dirname}/${subsys}.${prefix}.log"
done

for tag in $tags; do
    echo Extracting ${tag} logs...
    grep "${tag}" "${filename}" > "${dirname}/${tag}.${prefix}"
done

#for strip_tag in $strip_tags; do
strip_tag="live.dot"
    echo Extracting ${strip_tag}...
    grep "${strip_tag}:" "${filename}" | awk '{ FS="live.dot:"; print $2 }' > "${dirname}/${strip_tag}.${prefix}"
strip_tag="cib.updates"
    echo Extracting ${strip_tag}...
    grep "${strip_tag}:" "${filename}" | awk '{ FS="cib.updates:"; print $2 }' > "${dirname}/${strip_tag}.${prefix}"
#done

